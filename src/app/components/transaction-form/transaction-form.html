<app-layout>
  <div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Header -->
    <div class="mb-6">
      <h1 class="text-3xl font-bold text-white mb-1">
        {{ (isEditMode ? 'transactionForm.editTitle' : 'transactionForm.newTitle') | translate }}
      </h1>
      <p class="text-sm text-purple-200">{{ (isEditMode ? 'transactionForm.editSubtitle' : 'transactionForm.newSubtitle') | translate }}</p>
    </div>

    <!-- Error Message -->
    <div *ngIf="error" class="bg-red-500/20 backdrop-blur-xl border border-red-400/30 text-red-200 px-6 py-4 rounded-xl mb-6">
      {{ error | translate }}
    </div>

    <!-- Loading State -->
    <div *ngIf="loading && isEditMode" class="text-center py-16">
      <div class="inline-block animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-purple-500"></div>
      <p class="text-purple-200 mt-4">{{ 'common.loading' | translate }}</p>
    </div>

    <!-- Form -->
    <div *ngIf="!loading || !isEditMode" class="bg-white/10 backdrop-blur-xl rounded-2xl shadow-2xl p-8 border border-white/20">
      <form [formGroup]="transactionForm" (ngSubmit)="onSubmit()" class="space-y-6">

        <!-- Transaction Type -->
        <div>
          <label class="block text-sm font-medium text-purple-200 mb-3">
            {{ 'transactionForm.type' | translate }} <span class="text-red-400">*</span>
          </label>
          <div class="grid grid-cols-2 gap-4">
            <label class="relative flex cursor-pointer">
              <input
                type="radio"
                formControlName="type"
                value="INCOME"
                class="sr-only peer">
              <div class="w-full px-6 py-4 bg-white/5 hover:bg-white/10 border-2 border-white/20 peer-checked:border-green-500 peer-checked:bg-green-500/20 rounded-xl transition-all flex items-center justify-center space-x-3">
                <svg class="h-6 w-6 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11l5-5m0 0l5 5m-5-5v12" />
                </svg>
                <span class="text-white font-medium">{{ 'transactionForm.income' | translate }}</span>
              </div>
            </label>
            <label class="relative flex cursor-pointer">
              <input
                type="radio"
                formControlName="type"
                value="EXPENSE"
                class="sr-only peer">
              <div class="w-full px-6 py-4 bg-white/5 hover:bg-white/10 border-2 border-white/20 peer-checked:border-red-500 peer-checked:bg-red-500/20 rounded-xl transition-all flex items-center justify-center space-x-3">
                <svg class="h-6 w-6 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 13l-5 5m0 0l-5-5m5 5V6" />
                </svg>
                <span class="text-white font-medium">{{ 'transactionForm.expense' | translate }}</span>
              </div>
            </label>
          </div>
          <div *ngIf="isFieldInvalid('type')" class="text-red-400 text-sm mt-2">
            {{ 'transactionForm.typeRequired' | translate }}
          </div>
        </div>

        <!-- Category -->
        <div>
          <label for="category" class="block text-sm font-medium text-purple-200 mb-3">
            {{ 'transactionForm.category' | translate }} <span class="text-red-400">*</span>
          </label>
          <select
            id="category"
            formControlName="category"
            class="w-full px-4 py-3 bg-white/5 border border-white/20 text-white rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all placeholder-purple-300/50"
            [class.border-red-500]="isFieldInvalid('category')">
            <option value="" class="bg-gray-800">{{ 'transactionForm.selectCategory' | translate }}</option>
            <option *ngFor="let cat of getAvailableCategories()" [value]="cat" class="bg-gray-800">
              {{ formatCategory(cat) }}
            </option>
          </select>
          <div *ngIf="isFieldInvalid('category')" class="text-red-400 text-sm mt-2">
            {{ 'transactionForm.categoryRequired' | translate }}
          </div>
        </div>

        <!-- Amount -->
        <div>
          <label for="amount" class="block text-sm font-medium text-purple-200 mb-3">
            {{ 'transactionForm.amount' | translate }} <span class="text-red-400">*</span>
          </label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-purple-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <input
              id="amount"
              type="number"
              step="0.01"
              min="0.01"
              formControlName="amount"
              [placeholder]="'transactionForm.amountPlaceholder' | translate"
              class="w-full pl-12 pr-4 py-3 bg-white/5 border border-white/20 text-white rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all placeholder-purple-300/50"
              [class.border-red-500]="isFieldInvalid('amount')">
          </div>
          <div *ngIf="isFieldInvalid('amount')" class="text-red-400 text-sm mt-2">
            <span *ngIf="transactionForm.get('amount')?.errors?.['required']">{{ 'transactionForm.amountRequired' | translate }}</span>
            <span *ngIf="transactionForm.get('amount')?.errors?.['min']">{{ 'transactionForm.amountMin' | translate }}</span>
          </div>
        </div>

        <!-- Date -->
        <div>
          <label for="date" class="block text-sm font-medium text-purple-200 mb-3">
            {{ 'transactionForm.date' | translate }} <span class="text-red-400">*</span>
          </label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
              <svg class="h-5 w-5 text-purple-300" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
              </svg>
            </div>
            <input
              id="date"
              type="date"
              formControlName="date"
              class="w-full pl-12 pr-4 py-3 bg-white/5 border border-white/20 text-white rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
              [class.border-red-500]="isFieldInvalid('date')">
          </div>
          <div *ngIf="isFieldInvalid('date')" class="text-red-400 text-sm mt-2">
            {{ 'transactionForm.dateRequired' | translate }}
          </div>
        </div>

        <!-- Description -->
        <div>
          <label for="description" class="block text-sm font-medium text-purple-200 mb-3">
            {{ 'transactionForm.description' | translate }}
          </label>
          <textarea
            id="description"
            formControlName="description"
            rows="4"
            [placeholder]="'transactionForm.descriptionPlaceholder' | translate"
            class="w-full px-4 py-3 bg-white/5 border border-white/20 text-white rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all placeholder-purple-300/50 resize-none"></textarea>
        </div>

        <!-- Actions -->
        <div class="flex gap-4 pt-4">
          <button
            type="submit"
            [disabled]="loading"
            class="flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 disabled:from-gray-500 disabled:to-gray-600 text-white font-medium rounded-xl transition-all shadow-lg hover:scale-105 transform disabled:scale-100 disabled:cursor-not-allowed">
            {{ loading ? ('transactionForm.saving' | translate) : ((isEditMode ? 'transactionForm.updateButton' : 'transactionForm.createButton') | translate) }}
          </button>
          <button
            type="button"
            (click)="cancel()"
            [disabled]="loading"
            class="flex-1 px-6 py-3 bg-white/10 hover:bg-white/20 disabled:bg-white/5 border border-white/20 text-white font-medium rounded-xl transition-all hover:scale-105 transform disabled:scale-100 disabled:cursor-not-allowed">
            {{ 'transactionForm.cancelButton' | translate }}
          </button>
        </div>
      </form>
    </div>
  </div>
</app-layout>
